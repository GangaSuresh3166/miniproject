{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ title }} â€” Admin Dashboard</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      background: radial-gradient(circle at top left, #0d1117, #000);
      color: #e5e7eb;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
    }

    nav.navbar {
      background: linear-gradient(90deg, #111827, #1f2937);
    }

    .navbar-brand {
      color: white !important;
    }

    .form-container {
      background: rgba(17, 24, 39, 0.92);
      backdrop-filter: blur(10px);
      border-radius: 18px;
      padding: 35px;
      margin: 50px auto;
      max-width: 900px;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.6);
    }

    .form-label {
      font-weight: 600;
      color: #cbd5e1;
    }

    .form-control,
    textarea,
    select {
      background: rgba(31, 41, 55, 0.9);
      border: 1px solid #374151;
      color: #e5e7eb;
    }

    .form-control:focus {
      border-color: #60a5fa;
      box-shadow: 0 0 0 0.2rem rgba(96, 165, 250, 0.25);
    }

    .section-title {
      color: #60a5fa;
      font-size: 1.25rem;
      font-weight: bold;
      margin: 25px 0 15px;
      border-left: 4px solid #60a5fa;
      padding-left: 10px;
    }

    .subcategory-row {
      background: rgba(31, 41, 55, 0.4);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #374151;
    }

    .btn-save {
      background-color: #2563eb;
      color: white;
      font-weight: 600;
      border-radius: 10px;
      padding: 8px 24px;
    }

    .btn-save:hover {
      background-color: #1d4ed8;
    }

    .btn-cancel {
      background-color: #6b7280;
      color: white;
      font-weight: 600;
      border-radius: 10px;
      padding: 8px 24px;
    }

    .btn-cancel:hover {
      background-color: #4b5563;
    }

    .btn-add {
      background-color: #10b981;
      color: white;
      font-weight: 600;
      border-radius: 10px;
      padding: 6px 16px;
      margin-top: 10px;
    }

    .btn-add:hover {
      background-color: #059669;
    }
  </style>
</head>

<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg px-4">
    <span class="navbar-brand fw-bold">
      <i class="bi bi-list-ul me-2"></i>Admin Dashboard
    </span>

    <div class="ms-auto">
      <a href="{% url 'category_list' %}" class="btn btn-light btn-sm">
        <i class="bi bi-arrow-left-circle me-1"></i>Back to Categories
      </a>
    </div>
  </nav>

  <div class="container">
    <div class="form-container">

      <!-- PAGE TITLE -->
      <h3 class="text-center fw-bold text-info mb-4">
        {% if form.instance.pk %}
          <i class="bi bi-pencil-square me-2"></i>Edit Category
        {% else %}
          <i class="bi bi-plus-circle-fill me-2"></i>Add Category
        {% endif %}
      </h3>

      <!-- FORM START -->
      <form method="POST">
        {% csrf_token %}

        <!-- CATEGORY SECTION -->
        <div class="section-title">Category Information</div>

        <div class="mb-3">
          <label class="form-label">Category Name</label>
          {{ form.category_name }}
        </div>

        <div class="form-check mb-4">
          {{ form.is_active }}
          <label class="form-check-label ms-2">Active</label>
        </div>

        <!-- SUBCATEGORY SECTION -->
        <div class="section-title">Subcategories</div>

        {{ formset.management_form }}

        <div id="subcategory-container">

          {% for subform in formset %}
          <div class="subcategory-row mb-3">

            <div class="mb-3">
              <label class="form-label">Subcategory Name</label>
              {{ subform.subcategory_name }}
            </div>

            <div class="form-check mb-3">
              {{ subform.is_active }}
              <label class="form-check-label ms-2">Active</label>
            </div>

            <button type="button" class="btn btn-danger btn-sm remove-subcat">
              <i class="bi bi-x-circle"></i> Remove
            </button>

          </div>
          {% endfor %}

        </div>

        <button type="button" id="add-subcat-btn" class="btn btn-add">
          <i class="bi bi-plus-circle"></i> Add Another Subcategory
        </button>

        <!-- ACTION BUTTONS -->
        <div class="text-end mt-4">
          <button type="submit" class="btn btn-save">
            <i class="bi bi-check-circle me-1"></i>Save
          </button>

          <a href="{% url 'category_list' %}" class="btn btn-cancel ms-2">
            <i class="bi bi-x-circle me-1"></i>Back
          </a>
        </div>

      </form>
      <!-- FORM END -->

    </div>
  </div>

  <!-- JS FOR DYNAMIC FORMSET -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {

      let container = document.getElementById("subcategory-container");
      let addBtn = document.getElementById("add-subcat-btn");
      let totalForms = document.getElementById("id_form-TOTAL_FORMS");

      addBtn.addEventListener("click", function () {

        let formCount = parseInt(totalForms.value);
        let newForm = container.children[0].cloneNode(true);

        // Replace form index in cloned form
        newForm.innerHTML = newForm.innerHTML.replace(/form-\d+/g, `form-${formCount}`);

        // Reset inputs
        let inputs = newForm.querySelectorAll("input");
        inputs.forEach(input => input.value = "");

        container.appendChild(newForm);

        totalForms.value = formCount + 1;
      });

      container.addEventListener("click", function (e) {
        if (e.target.closest(".remove-subcat")) {
          if (container.children.length > 1) {
            e.target.closest(".subcategory-row").remove();
          }
        }
      });

    });
  </script>

</body>
</html>
