<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stock Report</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 m-0">Stock Report</h1>
    <div>
      <a class="btn btn-outline-secondary me-2" href="{% url 'report_dashboard' %}">Back to Dashboard</a>
      <a class="btn btn-success" href="{% url 'stock_report_export_csv' %}?q={{ query }}{% if active_category %}&category={{ active_category }}{% endif %}">Export CSV</a>
    </div>
  </div>

  <form class="row g-2 align-items-end mb-3" method="get">
    <div class="col-md-4">
      <label class="form-label">Search</label>
      <input type="text" name="q" value="{{ query }}" class="form-control" placeholder="Product name, SKU...">
    </div>
    <div class="col-md-4">
      <label class="form-label">Category</label>
      <select name="category" class="form-select">
        <option value="">All</option>
        {% for c in categories %}
          <option value="{{ c.id }}" {% if active_category|default:'' == c.id|stringformat:'s' %}selected{% endif %}>{{ c.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <button class="btn btn-primary">Apply</button>
    </div>
  </form>

  <div class="card shadow-sm">
    <div class="table-responsive">
      <table class="table table-striped align-middle mb-0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Category</th>
            {% if has_supplier %}<th>Supplier</th>{% endif %}
            <th>SKU</th>
            {% if has_price %}<th class="text-end">Price</th>{% endif %}
            {% if has_cost %}<th class="text-end">Cost</th>{% endif %}
            {% if has_quantity %}<th class="text-end">Qty</th>{% endif %}
            {% if has_reorder %}<th class="text-end">Reorder</th>{% endif %}
            {% if has_updated %}<th class="text-nowrap">Updated</th>{% endif %}
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
            <tr>
              <td>{{ r.id }}</td>
              <td>{{ r.name }}</td>
              <td>{{ r.category|default:"—" }}</td>
              {% if has_supplier %}<td>{{ r.supplier|default:"—" }}</td>{% endif %}
              <td>{{ r.sku|default:"—" }}</td>
              {% if has_price %}<td class="text-end">{{ r.price|default:"—" }}</td>{% endif %}
              {% if has_cost %}<td class="text-end">{{ r.cost_price|default:"—" }}</td>{% endif %}
              {% if has_quantity %}<td class="text-end">{{ r.quantity|default:"—" }}</td>{% endif %}
              {% if has_reorder %}<td class="text-end">{{ r.reorder_level|default:"—" }}</td>{% endif %}
              {% if has_updated %}<td class="text-nowrap">{{ r.updated_at|date:"Y-m-d H:i" }}</td>{% endif %}
            </tr>
          {% empty %}
            <tr><td colspan="10" class="text-center text-muted">No products found</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
</body>
</html>
